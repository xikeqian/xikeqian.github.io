<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>video.js</title>
    <link href="https://unpkg.com/video.js@6.11.0/dist/video-js.min.css" rel="stylesheet">
    <script src="https://unpkg.com/video.js@6.11.0/dist/video.min.js"></script>
    <!-- <script src="https://unpkg.com/videojs-flash/dist/videojs-flash.js"></script> -->
    <script src="https://unpkg.com/videojs-contrib-hls/dist/videojs-contrib-hls.js"></script>
    <style>
        .vjs-paused .vjs-big-play-button,
        .vjs-paused.vjs-has-started .vjs-big-play-button {
            display: block;
        }

        .video-js .vjs-big-play-button {
            font-size: 2.5em;
            line-height: 2.3em;
            height: 2.5em;
            width: 2.5em;
            -webkit-border-radius: 2.5em;
            -moz-border-radius: 2.5em;
            border-radius: 2.5em;
            background-color: #73859f;
            background-color: rgba(115, 133, 159, .5);
            border-width: 0.15em;
            margin-top: -1.25em;
            margin-left: -1.75em;
        }

        /* 中间的播放箭头 */
        .vjs-big-play-button .vjs-icon-placeholder {
            font-size: 1.63em;
        }

        /* 加载圆圈 */
        .vjs-loading-spinner {
            font-size: 2.5em;
            width: 2em;
            height: 2em;
            border-radius: 1em;
            margin-top: -1em;
            margin-left: -1.5em;
        }
    </style>
</head>

<body>
    <video id="my-player" class="video-js vjs-big-play-centered" controls>
        <source src="http://pili-live-hls.live.xxpie.com/xxpievideolive/5d64a54354e0af413231a4b1.m3u8"
            type="application/x-mpegURL">
        <p class="vjs-no-js">
            not support
        </p>
    </video>
    <script type="text/javascript">
        var queryCurrentTime = null;
        var player = videojs('my-player', {
            width: 400,
            height: 200,
            autoplay: false,
            preload: false,
            plugins: {
                reloadSourceOnError: {}
            },
            hls: {
                withCredentials: true
            }
        });
        player.on('error',function(e){
            console.log('error event');
        });
        player.on('play', function (e) {
            console.log('listened play event');
        });
        player.on('pause', function (e) {
            console.log('listened pause event');
        });
        player.on('send', function (e) {
            console.log('listened data send event');
        });
        player.on('loadeddata', function (e) {
            console.log('listened loaded data event');
        });
        player.on('durationchange', function (e) {
            console.log('listened durationchange event');
        })
        player.on('timeupdate', function (e) {
            var that = this;
            clearTimeout(queryCurrentTime);
            queryCurrentTime = setTimeout(function(e){
                console.log('listened timeupdate event');
                console.log(that.currentTime());
            },1000)
        });
        player.reloadSourceOnError();
        console.log( player.reloadSourceOnError);
        player.on('usage',function(e){
            console.log('hls-error-reload',e);
        });
        player.off('timeupdate', function () {
            console.log('off----------')
        })
    
        // videojs.Hls.xhr.beforeRequest = function (e) {
        //     console.log('hls beforeRequest event');
        //     console.log(player.currentTime());
        // }
        // videojs.Hls.xhr.afterRequest = function (e) {
        //     console.log('hls afterRequest event');
        //     console.log(player.currentTime());
        // }
        
        // var Hls = null;
        // setTimeout(function (e) {
        //     Hls = player.hls;
        //     Hls.on('hls-error-reload', function (e) {
        //         console.log('ddd');
        //     })
        // }, 10000);
        
        // window.player = player;
        // function loadError() {
        //     console.log('listened load error event');
        // }
    </script>
</body>

</html>